The MongoDB Sharded cluster can be accessed via the Mongos instances in port 27017 on the following DNS name from within your cluster:

    my-mongodb-sharded.default.svc.cluster.local

To get the root password run:

    export MONGODB_ROOT_PASSWORD=$(kubectl get secret --namespace default my-mongodb-sharded -o jsonpath=".data.mongodb-root-password" | base64 -d)

To connect to your database run the following command:

    kubectl run --namespace default my-mongodb-sharded-client --rm --tty -i --restart=Never --image docker.io/bitnami/mongodb-sharded:8.0.13-debian-12-r0 --command -- mongosh admin --host my-mongodb-sharded --authenticationDatabase admin -u root -p $MONGODB_ROOT_PASSWORD

To connect to your database from outside the cluster execute the following commands:

    kubectl port-forward --namespace default svc/my-mongodb-sharded 27017:27017 &
    mongosh --host 127.0.0.1 --authenticationDatabase admin -p $MONGODB_ROOT_PASSWORD

helm upgrade my-mongodb-sharded bitnami/mongodb-sharded -f values.yaml
helm list
helm uninstall my-mongodb-sharded

kubectl get pvc
kubectl delete pvc --all

kubectl debug node/i-00e1a4a5107cf9eb1 -it --image=ubuntu:22.04 -- bash
kubectl exec -it node-debugger-i-093591b6ac0fe5d96-r75lt -- bash

kubectl run --namespace default my-mongodb-sharded-client --rm --tty -i --restart=Never --image docker.io/bitnami/mongodb-sharded:8.0.13-debian-12-r0 --command -- mongosh admin --host my-mongodb-sharded --authenticationDatabase admin -u root -p mongodb123
kubectl run --namespace default my-mongodb-sharded-client --rm --tty -i --restart=Never --image docker.io/bitnami/mongodb-sharded:8.0.13-debian-12-r0 --command -- mongosh admin --host my-mongodb-sharded-shard0-data-0.my-mongodb-sharded-headless.default.svc.cluster.local:27017 --authenticationDatabase admin -u root -p mongodb123
kubectl exec -it my-mongodb-sharded-shard0-data-0 -- mongosh -u root -p mongodb123  --authenticationDatabase admin

db.getName()
db.dropDatabase()
db.serverStatus().wiredTiger.cache['bytes currently in the cache']
db.serverStatus().wiredTiger.cache['maximum bytes configured']
cfg = rs.conf()
cfg.members[0].priority = 2
cfg.members = [cfg.members[0]]
rs.reconfig(cfg, {force: true})

kubectl run ycsb-test --image=maven:3.8-openjdk-11 --rm -it --restart=Never -- bash
kubectl run ycsb-test-1 --rm -it --restart=Never --image=maven:3.8-openjdk-11 --overrides='{"apiVersion": "v1", "spec": {"nodeSelector": {"kubernetes.io/hostname": "i-0f2b3dba87cbc381b"}}}'  -- bash
kubectl run ycsb-test-2 --rm -it --restart=Never --image=maven:3.8-openjdk-11 --overrides='{"apiVersion": "v1", "spec": {"nodeSelector": {"kubernetes.io/hostname": "i-093591b6ac0fe5d96"}}}'  -- bash
kubectl attach ycsb-test -it

bin/ycsb.sh load mongodb -s   -P workloads/workloadr   -p mongodb.url="mongodb://root:mongodb123@my-mongodb-sharded:27017/ycsb?authSource=admin"
bin/ycsb.sh run mongodb -s   -P workloads/workloadr   -p mongodb.url="mongodb://root:mongodb123@my-mongodb-sharded:27017/ycsb?authSource=admin" -threads 10 > logs/run_10.log
bin/ycsb.sh run mongodb -s   -P workloads/workloadr   -p mongodb.url="mongodb://root:mongodb123@my-mongodb-sharded:27017/ycsb?authSource=admin&readPreference=secondary" -threads 10 > logs/run_10_s.log
bin/ycsb.sh run mongodb -s   -P workloads/workloadr   -p mongodb.url="mongodb://root:mongodb123@my-mongodb-sharded:27017/ycsb?authSource=admin&readPreference=nearest" -threads 10 -target 4000 2>&1 | tee logs/run_10_s.log